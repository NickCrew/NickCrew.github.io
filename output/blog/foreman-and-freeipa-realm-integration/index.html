<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en">
<!--<![endif]-->
	<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="author" content="Nick Ferguson">


        <title>devbear.net - <p>Foreman and FreeIPA Realm Integration</p></title>

            <link href="http://blog.devbear.net/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="devbear.net Full Atom Feed" />
            <link href="http://blog.devbear.net/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="devbear.net Full RSS Feed" />
        <!-- FAVICON -->
        <!-- CSS -->
        <link rel="stylesheet" href="../../theme/css/style.css">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

        <!-- Custom CSS -->
        	<link rel="stylesheet" href="../../theme/css/colors/blue.css" id="colors">

        <!-- Code highlight color scheme -->
            <link href="../../theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="virtualization" />
        <meta name="tags" contents="platforms" />
        <meta name="tags" contents="dns" />
        <meta name="tags" contents="freeipa" />
        <meta name="tags" contents="identity" />
    <meta property="og:type" content="article">
    <meta property="og:title" content="Foreman and FreeIPA Realm Integration">
    <meta property="og:url" content="blog/foreman-and-freeipa-realm-integration/">
    <meta property="og:description" content="How to integrate FreeIPA with Foreman and Katello for automatic DNS records, Home directory mounting, SSH keys and Identity Management during VM provisioning.">
    <meta property="article:published_time" content="Thursday, August 02, 2018">
    <meta name="twitter:title" content="Foreman and FreeIPA Realm Integration">
    <meta name="twitter:description" content="How to integrate FreeIPA with Foreman and Katello for automatic DNS records, Home directory mounting, SSH keys and Identity Management during VM provisioning.">
    <meta name="description" content="How to integrate FreeIPA with Foreman and Katello for automatic DNS records, Home directory mounting, SSH keys and Identity Management during VM provisioning.">
    <meta name="twitter:image" content="">
    <meta property="og:image" content="">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="devbear.net">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="../../blog/foreman-and-freeipa-realm-integration/">
	<meta property="og:title" content="<p>Foreman and FreeIPA Realm Integration</p>">
	<meta property="og:description" content="">
	   <meta property="og:image" content="../../images/guilherme-toti.jpg">
	<meta property="article:published_time" content="2018-08-02 00:00:00-04:00">
	</head>
	<body>
		<header id="header">
			<!-- Container -->
			<div class="container">
				<!-- Logo / Mobile Menu -->
				<div class="five columns">
					<div id="textlogo">
						<h1><a href="../../">devbear.net</a></h1>
					</div>
				</div>
						<!-- Navigation
				================================================== -->
				<div class="eleven columns">

					<nav id="navigation" class="menu">
						<ul id="responsive">

							<li><a href="../../">Home</a></li>

							    <li><a href="blog">Archives</a></li>

							        <li><a href="../../pages/about.html"><p>About</p></a></li>
							        <li><a href="../../pages/docbook.html"><p>Docbook Pages</p></a></li>
							        <li><a href="../../pages/homelab.html"><p>My Home Lab</p></a></li>
						</ul>
					</nav>
				</div>
			</div>
			<!-- Container / End -->
		</header>
		<!-- Header / End -->

		<!-- Breadcrumbs Container-->
		<div id="content-wrapper">
			<section id="titlebar">
				<!-- Container -->
				<div class="container">
				<div class="thirteen columns">
					<nav id="breadcrumbs">
						<ul>
							<li>You are here:</li>
							<li><a href="../../">Home</a></li>
<li><a href="../../category/tutorials.html">Tutorials</a></li>
<li><p>Foreman and FreeIPA Realm Integration</p></li>
						</ul>
					</nav>
				</div>
				</div>
				<!-- Container / End -->
			</section>

			<div class="container">
        <div class="twelve alt columns">
<article class="post" style="margin: 0; border: 0;">

	<section class="post-content">

		<header class="meta">
			<h2><a href="../../blog/foreman-and-freeipa-realm-integration/"><p>Foreman and FreeIPA Realm Integration</p></a></h2>
			<ul>
				<li>By <a href="../../author/nick-ferguson.html">Nick Ferguson</a></li>
				<li>Thu 02 August 2018</li>
			</ul>
		</header>

		<hr>
<h1>Synopsis</h1>
<p><strong>A configuration by which  hosts created with Foreman auto-join your FreeIPA Realm and registered as IPA hosts</strong></p>
<hr>
<h2>FreeIPA Host</h2>
<p>We need to create an IPA user for foreman. I used <em>"foreman-user"</em> but you can choose something different if you'd like. This article will assume <em>"foreman-user"</em>. Avoid foreman-proxy or other usernames that occur as users on the Foreman host. Assign this user the <strong>role</strong> of <em>Smart Proxy Host Manager</em>.</p>
<p>Before beginning, your Foreman host needs to be registered as an IPA host. </p>
<div class="highlight"><pre><span></span><span class="err">ipa-client-install</span>
</pre></div>


<p>We need to create a <strong>service</strong> for the Foreman proxy.  </p>
<p>If you're using the FreeIPA webui:  </p>
<p><code>Identity =&gt; Services =&gt; "add +"</code></p>
<p><em>Example:</em></p>
<div class="highlight"><pre><span></span><span class="err">foremanproxy/foreman.example.com@EXAMPLE.COM</span>
</pre></div>


<hr>
<h2>Foreman Host</h2>
<p>You need to install the <strong>ipa-admintools</strong> package:  </p>
<div class="highlight"><pre><span></span><span class="err">yum install ipa-admintools</span>
<span class="err">foreman-prepare-realm admin foreman-user</span>
</pre></div>


<p>We need to edit some config files. These are the relevant sections:</p>
<div class="highlight"><pre><span></span><span class="c1">### /etc/foreman-proxy/settings.d/freeipa_realm.yml</span>

<span class="c1"># Authentication for Kerberos-based Realms</span>
:keytab_path: /etc/foreman-proxy/freeipa.keytab
:principal: foreman-user@EXAMPLE.COM

:ipa_config: /etc/ipa/default.conf
<span class="c1"># Remove from DNS when deleting the FreeIPA entry</span>
:remove_dns: <span class="nb">true</span>
</pre></div>


<p><strong>/etc/foreman-proxy/settings.d/freeipa_realm.yml</strong>  </p>
<div class="highlight"><pre><span></span><span class="c1">### /etc/foreman-proxy/settings.d/realm.yml</span>

<span class="c1"># Can be true, false, or http/https to enable just one of the protocols</span>
:enabled: <span class="nb">true</span>

<span class="c1"># Available providers:</span>
<span class="c1">#   realm_ad</span>
<span class="c1">#   realm_freeipa</span>
:use_provider: realm_freeipa
</pre></div>


<p><strong>/etc/foreman-proxy/settings.d/realm.yml</strong>  </p>
<hr>
<h3>FreeIPA Host</h3>
<p>Copy the keytab from the IPA server, where <em>freeipa</em> is the hostname of your IPA server and <em>foremanproxy</em> is the name of the service:</p>
<div class="highlight"><pre><span></span>ipa-getkeytab -s freeipa.example.com -p foremanproxy/freeipa.example.com -k /etc/krb5.keytab *
</pre></div>


<p>Copy the keytab to the appropriate location:</p>
<div class="highlight"><pre><span></span>cp freeipa.keytab /etc/foreman-proxy/freeipa.keyab
</pre></div>


<p>Make the foreman-proxy user owner and set correct permissions:  </p>
<div class="highlight"><pre><span></span>chown foreman-proxy /etc/foreman-proxy/freeipa.leytab
</pre></div>


<div class="highlight"><pre><span></span>chmod <span class="m">600</span> /etc/foreman-proxy/freeipa.keytab
</pre></div>


<div class="highlight"><pre><span></span>cp /etc/ipa/ca.crt /etc/pki/ca-trust/source/anchors/ipa.crt
</pre></div>


<div class="highlight"><pre><span></span>update-ca-trust <span class="nb">enable</span> <span class="o">&amp;&amp;</span> update-ca-trust
</pre></div>


<div class="highlight"><pre><span></span>systemctl restart foreman-proxy
</pre></div>


<p>Test the keytab is present:</p>
<div class="highlight"><pre><span></span>   sudo -u foreman-user kinit -k -t /etc/foreman-proxy/freeipa.keytab foreman-user
</pre></div>


<p>You should now be able to select your realm in the Foreman webui  </p>
<p><code>Infrastructure =&gt; Realms</code>  </p>
<p>Ensure your provisioning template calls the <strong><em>freeipa_register</em></strong> snippet. Read over the snippet to see optional host parameters you may set.  </p>
<blockquote>
<p>If you are using FreeIPA as your DNS server and you would like the records automatically updated, set the following host parameter:  </p>
</blockquote>
<p><code>Name: freeipa_opts Value: —enable-dns-updates</code></p>
<blockquote>
<p>If you are using the automount feature of FreeIPA:  </p>
</blockquote>
<p><code>Name: freeipa_automount Value: true</code></p>
<p>Now when you create a host, as long as you have your realm selected, it should automatically join the realm and register with the server.  </p>
		    <div class="tags">
		        <p>tags: <a href="../../tag/virtualization.html">virtualization</a><a href="../../tag/platforms.html">platforms</a><a href="../../tag/dns.html">dns</a><a href="../../tag/freeipa.html">freeipa</a><a href="../../tag/identity.html">identity</a></p>
		    </div>

<div class="sharing">
</div>
<hr>

	</section>
	<div class="clearfix"></div>

</article>

        </div>

        <!-- Sidebar -->
        <div class="four columns">
                <!-- About  -->
                <div class="widget no-mg-top">
                        <h3 class="headline">About</h3><span class="line"></span><div class="clearfix"></div>
                        <p>Build and Release Platform Developer located in Clearwater, FL. Special focus on Linux & Containerized Apps, .NET Core, PowerShell, Build & Automation.</p>
                </div>




                <!-- categories -->
                <div class="widget">
                        <h3 class="headline">categories</h3><span class="line"></span><div class="clearfix"></div>
                        <nav class="categories">
                                <ul>
                                            <li><a href="/category/articles.html">Articles</a></li>
                                            <li class="active"><a href="/category/tutorials.html">Tutorials</a></li>
                                </ul>
                        </nav>
                </div>
                
                <!-- Tags -->
                <div class="widget">
                        <h3 class="headline">Tags</h3><span class="line"></span><div class="clearfix"></div>
                        <nav class="tags">                                    <a href="../../tag/applications.html">applications</a>
                                    <a href="../../tag/dns.html">dns</a>
                                    <a href="../../tag/freeipa.html">freeipa</a>
                                    <a href="../../tag/identity.html">identity</a>
                                    <a href="../../tag/kvm.html">kvm</a>
                                    <a href="../../tag/lab.html">lab</a>
                                    <a href="../../tag/libvirt.html">libvirt</a>
                                    <a href="../../tag/networking.html">networking</a>
                                    <a href="../../tag/openvswitch.html">OpenVSwitch</a>
                                    <a href="../../tag/platforms.html">platforms</a>
                                    <a href="../../tag/python.html">python</a>
                                    <a href="../../tag/snippets.html">snippets</a>
                                    <a href="../../tag/virtualization.html">virtualization</a>
                        </nav>
                </div>
        </div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Content Wrapper / End -->

		<div id="footer-bottom">
			<!-- Container -->
			<div class="container">
				<div class="eight columns">&copy; Copyright 2020 Nick Ferguson || Blog powered by <a href="http://getpelican.com">Pelican</a></div>
					<div class="eight columns">
						<ul class="social-icons-footer">
								<li>
									<a href="https://github.com/NickCrew" class="tooltip top" title="Github">
										<i class="fab fa-github"></i>
									</a>
								</li>
								<li>
									<a href="https://www.youtube.com/channel/UC972wwbPrKXW-YlXCPGPbQw" class="tooltip top" title="YouTube">
										<i class="fab fa-youtube"></i>
									</a>
								</li>
								<li>
									<a href="https://twitter.com/piggahmonster" class="tooltip top" title="Twitter">
										<i class="fab fa-twitter"></i>
									</a>
								</li>
						</ul>
					</div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Footer Bottom / End -->

	<!-- Javascripts -->
	<script src="../../theme/js/jquery.min.js"></script>
	</body>
</html>